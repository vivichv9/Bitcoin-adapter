# Bitcoin Adapter

## Описание
Bitcoin Adapter - это веб-приложение на JavaScript для упрощения работы с блокчейном Bitcoin в понятном для человека формате.  
Пользователь заполняет форму с параметрами транзакции или данных, а приложение преобразует введенные значения в корректное hex-представление для отправки в сеть.

## Цель проекта
Снять технический порог при работе с низкоуровневыми форматами Bitcoin и дать удобный интерфейс для:
- подготовки данных к отправке через `generateblock`;
- подготовки raw-транзакций для отправки через `sendrawtransaction`;
- проверки корректности подписи транзакций;
- генерации Bitcoin-адресов;
- отображения всех возможных script-типов по публичному ключу.

## Ключевые возможности
1. Конструктор форм для ручного ввода данных.
2. Конвертация введенных полей в hex-формат.
3. Валидация структуры и обязательных параметров перед генерацией.
4. Генерация адресов (в разных поддерживаемых форматах сети Bitcoin).
5. Проверка подписи транзакций с выводом результата и причины ошибки.
6. Анализ публичного ключа и отображение доступных script-вариантов.

## Принцип работы
1. Пользователь заполняет форму в веб-интерфейсе.
2. Приложение валидирует входные данные.
3. Внутренний модуль сериализации переводит данные в бинарный формат и hex.
4. Пользователь получает итоговый hex и может использовать его в Bitcoin RPC-командах.

## Основные сценарии использования
- Подготовка raw-транзакции без ручного кодирования полей.
- Быстрая проверка подписи перед отправкой в сеть.
- Исследование соответствий между публичным ключом, адресами и script-типами.

## Ограничения первой версии
- Основной фокус на Bitcoin mainnet/testnet RPC-интеграции.
- Расширенная автоматизация построения сложных транзакций (multisig, timelock и др.) будет добавляться поэтапно.

## Локальный запуск
1. `npm run dev` - поднять локальный сервер разработки (по умолчанию `http://localhost:5173`).
2. `npm run build` - собрать приложение в папку `dist`.
3. `npm run test` - запустить unit-тесты.
4. `npm run check` - выполнить синтаксическую проверку, тесты и сборку.
5. `npm run test:integration` - интеграционные тесты с локальным Bitcoin Core (при наличии env).
6. `npm run test:regression` - регрессионный прогон (unit + build).

## RPC-интеграция (dev)
1. В UI заполните RPC-конфиг узла: `protocol`, `host`, `port`, `username`, `password`, `wallet(optional)`.
2. Сохраните конфиг кнопкой "Сохранить RPC конфиг" (сохраняется в `localStorage` браузера).
3. Для `sendrawtransaction` сначала сгенерируйте hex, затем нажмите "Вызвать sendrawtransaction".
4. Для `generateblock` укажите адрес и нажмите "Вызвать generateblock". Если в поле hex есть данные, они будут добавлены как массив транзакций параметра метода.

Важно:
- RPC-запросы отправляются через локальный прокси `POST /api/rpc` в dev-сервере.
- Убедитесь, что Bitcoin Core RPC доступен и разрешает подключение с вашей машины.

## Генерация и проверка адресов
1. В секции "Генерация адресов" введите публичный ключ и нажмите "Сгенерировать адреса".
2. Приложение сформирует descriptors и запросит адреса через RPC `deriveaddresses` для типов:
- `p2pkh`
- `p2wpkh`
- `p2sh-p2wpkh`
- `p2pk`
- `p2tr`
3. В секции "Проверка адреса" можно проверить адрес через RPC `validateaddress`.

Ограничение текущей версии:
- Генерация реализована по публичному ключу и требует доступного Bitcoin Core RPC.
- Генерация адресов напрямую из приватного ключа будет добавлена отдельным шагом.

## Скрипты по публичному ключу
1. В секции "Типы скриптов по публичному ключу" введите pubkey и нажмите "Показать варианты".
2. Приложение выводит:
- тип скрипта;
- descriptor;
- шаблон script;
- итоговый `scriptPubKey` (локально для P2PK и через RPC, где доступно);
- адрес (где применимо).
3. Результаты можно экспортировать кнопками:
- `Экспорт JSON`
- `Экспорт TXT`

## UX и безопасность
1. История операций сохраняется локально в браузере.
2. Доступны действия:
- экспорт истории в JSON;
- очистка истории.
3. Базовые меры безопасности:
- RPC-пароль не сохраняется в `localStorage`;
- в истории чувствительные поля редактируются (`<redacted>`);
- длинные hex-строки в истории маскируются.

## Проверка подписи транзакции
1. В секции "Проверка подписи транзакции" вставьте подписанный raw tx hex.
2. Опционально задайте `maxFeeRate` (BTC/kvB).
3. Приложение вызывает `testmempoolaccept` и возвращает:
- `valid: true/false`
- `reason` (почему транзакция принята или отклонена)
- `txid` и исходные детали ответа RPC.

## Статус
Реализованы этапы 1-9 (в рамках текущего объема): базовый UI, схемная валидация, нормализация и сериализация hex, RPC-конфигурация узла, payload для `sendrawtransaction`/`generateblock`, генерация и проверка адресов через RPC, проверка подписи транзакции через `testmempoolaccept`, расширенный вывод script-типов с `scriptPubKey` и экспортом, история операций и базовые меры безопасности, интеграционные/регрессионные тестовые сценарии, релизные артефакты.
Детальный roadmap см. в `PLANS.md`.

## Этап 9 (тестирование и релиз)
Добавлены артефакты релизной подготовки:
- `tests/integration/bitcoin-core.integration.test.mjs` (интеграционные тесты, auto-skip без env);
- `scripts/regression.mjs` (регрессионный прогон);
- `CHANGELOG.md`;
- `RELEASE.md` (release checklist).
